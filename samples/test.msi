# -*- coding: iso-8859-1 -*-
from __future__ import print_function, division
import	sys
if( sys.version_info[0] == 2 ):
	range = xrange
import	random
import	time
import	math
import	msi

random.seed()

if( len( sys.argv ) == 1 ):
	con = msi.server( 10 )
else:
	con = msi.client( sys.argv[1] )

nel = 2300
con.barrier()
if( con.node == 0 ):
	for i in range( 1, con.ncpu ):
		tmp = con.recv_r8( i, nel )
		time.sleep( random.randint( 1, 10 ) )
		con.send_r8( i, tmp )
else:
	tmp = [ random.random() for i in range( nel ) ]
	time.sleep( random.randint( 1, 10 ) )
	con.send_r8( tmp )
	pmt = con.recv_r8( nel )
	print( con.node, sum( [ math.fabs( i - j ) for i,j in zip( tmp, pmt ) ] ) )
